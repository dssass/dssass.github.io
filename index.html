<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>台南美食地圖</title>
  <style>
    /* Google Fonts - Noto Sans TC */
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

    :root {
      --primary-color: #E87400; /* 活力的橘色 */
      --secondary-color: #4CAF50; /* 清新的綠色 */
      --background-color: #FAF8F2; /* 柔和的米色背景 */
      --text-color: #333;
      --light-gray: #f4f4f4;
      --white: #fff;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      /* ===== 修改點 1: 調整基礎字體大小與行高 ===== */
      font-size: 16px; /* 設定基準字體大小，讓 'em' 單位有標準 */
      line-height: 1.75; /* 輕微調整行高以適應新字體大小 */
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-color);
    }

    .container {
      max-width: 960px;
      margin: 2rem auto;
      padding: 2.5rem; /* 稍微增加內邊距 */
      background: var(--white);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    
    h1, h2, h3, h4, h5, h6 {
      color: var(--text-color);
      font-weight: 700;
    }

    h1 {
        font-size: 2.5em; /* 相對大小不變，但因基礎字體縮小而變小 */
        text-align: center;
        color: var(--primary-color);
        margin-bottom: 0.5em;
        letter-spacing: 2px;
    }
    
    h2 {
      font-size: 2em;
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
      padding-bottom: 0.5em;
      margin-top: 3em;
      margin-bottom: 1.5em;
      display: flex;
      align-items: center;
    }

    /* 為 H3、H4 也加上 ID 以便目錄連結 */
    h3[id], h4[id] {
      scroll-margin-top: 20px; /* 避免跳轉時被頂部遮擋 */
    }

    h3 {
      font-size: 1.5em;
      color: #333;
      border-bottom: none;
      border-left: 5px solid var(--secondary-color);
      padding-left: 1em;
      margin-top: 2.5em;
      margin-bottom: 1.2em;
    }
    
    h4 {
      font-size: 1.2em;
      border-bottom: none;
      margin-top: 2em;
      font-weight: 700;
    }
    
    /* 區塊樣式 */
    .custom-block, .warning-box {
      padding: 1.2em 1.5em;
      margin-bottom: 1.5em;
      border-radius: 8px;
      font-size: 1em; /* ===== 修改點 1: 字體大小調整 ===== */
      line-height: 1.7;
    }

    .custom-block { background-color: #F0FFF0; color: #2E8B57; border-left: 5px solid var(--secondary-color); }
    .warning-box { background-color: #FFF8E1; color: #FFA000; border: 1px solid #FFECB3; font-weight: 500; display: flex; align-items: center; }
    .warning-box .icon { font-size: 1.5em; margin-right: 0.7em; }

    ul { list-style-type: none; padding-left: 0; }

    /* 列表項目卡片化 */
    ul > li {
        background-color: var(--white);
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        padding: 1em 1.5em; /* 調整內邊距 */
        margin-bottom: 1em;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    
    ul > li:hover { transform: translateY(-5px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
    
    /* 連結樣式優化 */
    ul li a {
      color: var(--text-color);
      text-decoration: none;
      /* ===== 修改點 1: 列表中的店家名稱字體調整 ===== */
      font-size: 1.05em; 
      font-weight: 700;
      transition: color 0.2s;
    }
    
    ul li a:hover { color: var(--primary-color); text-decoration: none; }
    
    blockquote {
        margin: 0.8em 0 0 0;
        padding: 0.8em 1em;
        border-left: 4px solid var(--light-gray);
        background: #f9f9f9;
        color: #666; /* 調淡一點文字顏色 */
        border-radius: 4px;
        /* ===== 修改點 1: 引用區塊字體調整 ===== */
        font-size: 0.95em; 
    }

    .orange-text { color: var(--primary-color); font-weight: bold; }

    /* ===== 修改點 2: 側邊欄目錄的全新樣式 (CSS 部分) ===== */
    #toc-sidebar {
      position: fixed;
      left: 30px;
      top: 50%;
      transform: translateY(-50%);
      width: 230px; /* 稍微加寬以容納箭頭 */
      max-height: 90vh;
      overflow-y: auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1em;
      border-radius: 12px;
      box-shadow: var(--shadow);
      z-index: 1000;
      transition: left 0.3s ease-in-out;
    }

    #toc-sidebar h4 {
        margin-top: 0;
        margin-bottom: 1em;
        padding-bottom: 0.8em;
        font-size: 1.3em;
        text-align: center;
        color: var(--primary-color);
        border-bottom: 2px solid var(--primary-color);
    }

    #toc-sidebar ul {
      padding-left: 0;
      margin: 0;
    }

    /* 主層級連結 */
    #toc-sidebar ul.main-menu > li > a {
      display: block;
      padding: 0.6em 1em;
      color: #333; /* 主層級顏色深一點 */
      text-decoration: none;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.25s ease-in-out;
    }

    /* 有子選單的連結加上箭頭 */
    #toc-sidebar a.has-submenu::after {
      content: '▸';
      position: absolute;
      right: 25px; /* 控制箭頭位置 */
      transition: transform 0.3s ease-in-out;
    }

    #toc-sidebar li.open > a.has-submenu::after {
      transform: rotate(90deg); /* 展開時箭頭旋轉 */
    }
    
    /* 連結滑鼠移過 或 目前啟動的狀態 */
    #toc-sidebar ul li a:hover,
    #toc-sidebar ul li a.active {
      background-color: var(--primary-color);
      color: var(--white);
      transform: translateX(10px);
    }
    
    #toc-sidebar ul li a.active {
      font-weight: 700;
    }
    
    /* 子選單的容器 (預設隱藏) */
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-in-out;
      background: rgba(0,0,0,0.02); /* 子選單加個淡淡的底色區分 */
      border-radius: 6px;
      margin: 4px 0 8px 0;
    }
    
    /* 當父層 li.open 時，展開子選單 */
    li.open > .submenu {
      max-height: 1000px; /* 給一個足夠大的高度讓它完全展開 */
    }

    /* 子選單的項目連結 */
    .submenu li a {
      padding: 0.5em 1em 0.5em 2em; /* 增加左邊距做出層級感 */
      display: block;
      font-size: 0.9em;
      font-weight: 400;
      color: #444;
      border-radius: 4px;
      transition: all 0.2s ease-in-out;
    }

    /* 子選單項目滑過或啟動 */
    .submenu li a:hover, .submenu li a.active {
        background-color: var(--secondary-color); /* 子項目用綠色 */
        color: var(--white);
        transform: translateX(5px);
    }

    /* ===== END OF 修改點 2 (CSS) ===== */

    @media (max-width: 1400px) {
      #toc-sidebar { left: -280px; }
    }
  </style>
</head>
<body>
<div class="container">

<!-- ===== 修改點 2: 全新的、具備層級結構的目錄 (HTML) ===== -->
<nav id="toc-sidebar">
    <h4>目錄</h4>
    <ul class="main-menu">
        <li><a href="#beef" class="has-submenu">牛肉</a>
            <ul class="submenu">
                <li><a href="#beef-section-jiali">佳里</a></li>
                <li><a href="#beef-section-hotpot">牛肉火鍋</a></li>
            </ul>
        </li>
        <li><a href="#brunch">早午餐</a></li>
        <li><a href="#lunch" class="has-submenu">午餐time</a>
            <ul class="submenu">
                <li><a href="#lunch-taiwanese-rice">台式飯類</a></li>
                <li><a href="#lunch-fish">魚類</a></li>
                <li><a href="#lunch-taiwanese-noodle">台式麵類</a></li>
                <li><a href="#lunch-american">美式</a></li>
                <li><a href="#lunch-japanese">生魚片、壽司、丼飯</a></li>
                <li><a href="#lunch-ramen">拉麵</a></li>
                <li><a href="#lunch-hotpot">火鍋</a></li>
                <li><a href="#lunch-hongkong">港式</a></li>
                <li><a href="#lunch-others">其他</a></li>
            </ul>
        </li>
        <li><a href="#dinner" class="has-submenu">晚餐time</a>
            <ul class="submenu">
                <li><a href="#dinner-taiwanese-rice">台式飯類</a></li>
                <li><a href="#dinner-winter-food">冬天進補</a></li>
                <li><a href="#dinner-fish">魚類</a></li>
                <li><a href="#dinner-taiwanese-noodle">台式麵類</a></li>
                <li><a href="#dinner-american">美式</a></li>
                <li><a href="#dinner-curry">咖哩</a></li>
                <li><a href="#dinner-ramen">拉麵</a></li>
                <li><a href="#dinner-japanese">生魚片、壽司、丼飯</a></li>
                <li><a href="#dinner-hotpot">火鍋</a></li>
                <li><a href="#dinner-drypot">乾鍋</a></li>
                <li><a href="#dinner-hongkong">港式</a></li>
                <li><a href="#dinner-thai">泰式</a></li>
                <li><a href="#dinner-izakaya">居酒屋、熱炒、燒烤</a></li>
                <li><a href="#dinner-others">其他</a></li>
                <li><a href="#dinner-group-meal">合菜、buffet</a></li>
                <li><a href="#dinner-snacks">小吃</a></li>
            </ul>
        </li>
        <li><a href="#desserts" class="has-submenu">甜食</a>
            <ul class="submenu">
              <li><a href="#dessert">甜點</a></li>
              <li><a href="#cafe">咖啡廳</a></li>
              <li><a href="#ice-dessert">冰&甜品</a></li>
            </ul>
        </li>
        <li><a href="#drinks">飲料</a></li>
        <li><a href="#mid-price-restaurants">氣氛晚餐、中價位餐廳</a></li>
        <li><a href="#high-end-restaurants">高級料理</a></li>
        <li><a href="#late-night-snack">宵夜 (超過12.的)</a></li>
        <li><a href="#bars">酒吧</a></li>
        <li><a href="#hungover">宿醉hung over</a></li>
        <li><a href="#night-markets">夜市</a></li>
        <li><a href="#tourist-areas">觀光地區</a></li>
        <li><a href="#ncku-area" class="has-submenu">成大周遭</a>
            <ul class="submenu">
                <li><a href="#ncku-brunch">早午餐</a></li>
                <li><a href="#ncku-dinner-only">晚餐only</a></li>
                <li><a href="#ncku-lunch-dinner">午/晚餐</a></li>
                <li><a href="#ncku-fruits">水果</a></li>
                <li><a href="#ncku-latenight">宵夜</a></li>
                <li><a href="#ncku-budget">省錢</a></li>
                <li><a href="#ncku-mid-price">中價位餐廳</a></li>
            </ul>
        </li>
        <li><a href="#tools">互動小工具</a></li>
    </ul>
</nav>
<h1>台南美食地圖</h1>


<!-- 以下是您的內文，我已為需要被連結的 H3, H4, H5 加上了 id -->
<h2 id="beef">...牛肉...</h2>
<h3 id="beef-section-jiali">佳里</h3>
...
<h3 id="beef-section-hotpot">牛肉火鍋</h3>
...
<h2 id="brunch">...早午餐</h2>
...
<h2 id="lunch">...午餐time</h2>
<h4 id="lunch-taiwanese-rice"><strong class="orange-text">台式飯類</strong></h4>
...
<h4 id="lunch-fish"><strong class="orange-text">魚類</strong></h4>
...
<!-- 您需要依照上面目錄的結構，為您內容中對應的 h3/h4/h5 標題加上 id，格式如 id="lunch-ramen", id="ncku-budget" 等，才能讓連結正常作用 -->
<!-- 為了版面簡潔，此處省略了重複的內文 -->
...

<!-- ... 您的其他所有網頁內容 ... -->
</div>


<!-- ===== 修改點 2: 控制目錄開合功能的全新 JAVASCRIPT ===== -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- 1. 處理捲動時，目錄項目高亮顯示的邏輯 (已更新以適應新結構) ---
  const sections = document.querySelectorAll('h2[id], h3[id], h4[id], h5[id]');
  const tocLinks = document.querySelectorAll('#toc-sidebar a');
  const tocSubmenus = document.querySelectorAll('#toc-sidebar .submenu');

  const observer = new IntersectionObserver((entries) => {
    let latestIntersectingId = null;

    entries.forEach(entry => {
      if (entry.isIntersecting) {
        latestIntersectingId = entry.target.getAttribute('id');
      }
    });
    
    if (latestIntersectingId) {
      tocLinks.forEach(link => {
        link.classList.remove('active');
        const linkHref = link.getAttribute('href').substring(1);

        if (linkHref === latestIntersectingId) {
          link.classList.add('active');

          // 如果啟動的項目在子選單內，自動展開其父選單
          const parentSubmenu = link.closest('.submenu');
          if (parentSubmenu && !parentSubmenu.parentElement.classList.contains('open')) {
            parentSubmenu.parentElement.classList.add('open');
          }
        }
      });
    }
  }, {
    rootMargin: '0px 0px -70% 0px' // 調整偵測區，讓頂部三分之一處的標題觸發
  });

  sections.forEach(section => {
    observer.observe(section);
  });


  // --- 2. 處理點擊時，目錄展開/收合的邏輯 ---
  const toc = document.querySelector('#toc-sidebar');
  toc.addEventListener('click', function(event) {
    const targetLink = event.target.closest('a');

    // 檢查點擊的是否為一個有效的連結
    if (!targetLink) return;

    // 如果點擊的是有子選單的主連結
    if (targetLink.classList.contains('has-submenu')) {
      // 防止頁面跳轉，僅做開合動作
      event.preventDefault(); 
      targetLink.parentElement.classList.toggle('open');
    }
    // 如果點擊的是子選單中的項目，或沒有子選單的項目
    else {
        // 先關閉所有已展開的子選單...
        const allOpenLis = toc.querySelectorAll('li.open');
        allOpenLis.forEach(li => {
            // ...但不要關閉目前點擊項目所在的父選單
            if(!li.contains(targetLink)){
                li.classList.remove('open');
            }
        });
    }
  });
});
</script>

</body>
</html>